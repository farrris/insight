{"ast":null,"code":"var _jsxFileName = \"/Users/vladislavsderzikov/Desktop/Projects/insight/client/src/components/chat/index.js\",\n  _s = $RefreshSig$();\nimport \"./index.css\";\nimport NavBar from \"../../components/navbar\";\nimport Container from 'react-bootstrap/Container';\nimport { useEffect, useState } from \"react\";\nimport useWebSocket, { ReadyState } from \"react-use-websocket\";\nimport { Form } from \"react-bootstrap\";\nimport sendImg from \"../../assets/send.png\";\nimport { Image } from \"react-bootstrap\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Chat({\n  chat\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const user = JSON.parse(localStorage.getItem(\"user\"));\n  const accessToken = localStorage.getItem(\"access\");\n  const WS_URL = \"ws://127.0.0.1:8000/ws/chat/\" + chat.id + \"?auth_token=\" + accessToken;\n  const socket = new WebSocket(WS_URL);\n  const timeFormat = fullDateString => {\n    return fullDateString.slice(11, 16);\n  };\n  const wsSend = data => {\n    if (!socket.readyState) {\n      setTimeout(() => {\n        wsSend(data);\n      }, 100);\n    } else {\n      socket.send(data);\n    }\n  };\n  const sendMessage = message => {\n    let input = document.getElementsByClassName(\"send-message-input\")[0];\n    let stringData = JSON.stringify({\n      message: input.value\n    });\n    wsSend(stringData);\n    input.value = \"\";\n  };\n  useEffect(() => {\n    socket.onmessage = function (event) {\n      let jsonData = JSON.parse(event.data);\n      if (jsonData.message) {\n        setMessages(messages => [...messages, jsonData.message]);\n      }\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"full-chat\",\n      children: messages.map(message => message.from_user.id == user.id ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message-my-card-block d-flex justify-content-end\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"message-my-card\",\n          children: message.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: timeFormat(message.sended_at)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 29\n        }, this)]\n      }, message.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message-user-card-block d-flex justify-content-start\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"message-user-card\",\n          children: message.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: timeFormat(message.sended_at)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 29\n        }, this)]\n      }, message.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 25\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex\",\n      children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n        type: \"text\",\n        className: \"send-message-input custom-form-input\",\n        placeholder: \"\\u041D\\u0430\\u043F\\u0438\\u0441\\u0430\\u0442\\u044C\",\n        onKeyDown: event => {\n          if (event.key == \"Enter\") sendMessage(message);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Image, {\n        onClick: () => sendMessage(message),\n        style: {\n          marginTop: \"30px\",\n          marginLeft: \"20px\"\n        },\n        src: sendImg,\n        width: 50,\n        height: 50\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 9\n  }, this);\n}\n_s(Chat, \"cirg1XNVuY5I7aqZjd23CdWZMY0=\");\n_c = Chat;\nexport default Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["NavBar","Container","useEffect","useState","useWebSocket","ReadyState","Form","sendImg","Image","jsxDEV","_jsxDEV","Chat","chat","_s","messages","setMessages","message","setMessage","user","JSON","parse","localStorage","getItem","accessToken","WS_URL","id","socket","WebSocket","timeFormat","fullDateString","slice","wsSend","data","readyState","setTimeout","send","sendMessage","input","document","getElementsByClassName","stringData","stringify","value","onmessage","event","jsonData","children","className","map","from_user","text","fileName","_jsxFileName","lineNumber","columnNumber","sended_at","Control","type","placeholder","onKeyDown","key","onClick","style","marginTop","marginLeft","src","width","height","_c","$RefreshReg$"],"sources":["/Users/vladislavsderzikov/Desktop/Projects/insight/client/src/components/chat/index.js"],"sourcesContent":["import \"./index.css\";\nimport NavBar from \"../../components/navbar\";\nimport Container from 'react-bootstrap/Container';\nimport { useEffect, useState} from \"react\";\nimport useWebSocket, { ReadyState } from \"react-use-websocket\"\nimport { Form } from \"react-bootstrap\";\nimport sendImg from \"../../assets/send.png\"\nimport { Image } from \"react-bootstrap\";\n\nfunction Chat({chat}) {\n    const [messages, setMessages] = useState([]);\n    const [message, setMessage] = useState(\"\");\n    const user = JSON.parse(localStorage.getItem(\"user\"));\n    const accessToken = localStorage.getItem(\"access\");\n    const WS_URL = \"ws://127.0.0.1:8000/ws/chat/\" + chat.id + \"?auth_token=\" + accessToken;\n    const socket = new WebSocket(WS_URL);\n\n    const timeFormat = (fullDateString) => {\n        return fullDateString.slice(11, 16);\n    }\n\n    const wsSend = (data) => {\n        if(!socket.readyState){\n            setTimeout(() => {\n                wsSend(data);\n            }, 100);\n        } else{\n            socket.send(data);\n        }\n    };\n\n    const sendMessage = (message) => {\n        let input =  document.getElementsByClassName(\"send-message-input\")[0];\n        let stringData = JSON.stringify({message: input.value});\n        wsSend(stringData);\n        input.value = \"\";\n    }\n\n    useEffect(() => {\n        socket.onmessage = function(event) {\n            let jsonData = JSON.parse(event.data);\n            if (jsonData.message) {\n                setMessages(messages => [...messages, jsonData.message]);\n            }\n        };\n    }, [])\n    \n    return (\n        <div>\n            <div className=\"full-chat\">\n                {messages.map((message) => (\n                    message.from_user.id == user.id ? \n                        <div className=\"message-my-card-block d-flex justify-content-end\" key={message.id}>\n                            <p className=\"message-my-card\">{message.text}</p>\n                            <p>{timeFormat(message.sended_at)}</p>\n                        </div>\n                     :\n                        <div className=\"message-user-card-block d-flex justify-content-start\" key={message.id}>\n                            <p className=\"message-user-card\">{message.text}</p>\n                            <p>{timeFormat(message.sended_at)}</p>\n                        </div>\n                    \n                ))}\n            </div>\n            <div className=\"d-flex\">\n                <Form.Control type=\"text\" className=\"send-message-input custom-form-input\" placeholder=\"Написать\" onKeyDown={event => {if (event.key == \"Enter\") sendMessage(message)}} />\n                <Image onClick={() => sendMessage(message)} style={{marginTop: \"30px\", marginLeft: \"20px\"}} src={sendImg} width={50} height={50}/>\n            </div>\n        </div>\n    )\n}\n\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}